<!DOCTYPE>

<html>

<head>

	<title>NCL Research Enterprises</title>
	<!-- link to CSS stylesheet, fonts & plugins -->
	<link rel="stylesheet" type="text/css" href="style.css"/>
	<link href='https://fonts.googleapis.com/css?family=Raleway:700' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Lora:400,700' rel='stylesheet' type='text/css'>
	<!-- favicon -->
	<link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon"/>
	<!-- scripts -->
	<script type='text/javascript' src="http://code.jquery.com/jquery-latest.min.js "></script>
	<!-- d3 -->
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<!-- metadata -->
	<meta charset="UTF-8"/>
	<meta name="keywords" content="web of science, research visualisation, newcastle university research"/>
	<meta name="description" content="A means of querying the Thomson Reuters Web of Science database using their API with SOAP HTTPS exchanges"/>
	<meta name="author" content="John Dawson"/>

</head>

<body>

	</br><h1 id="graphHeader">Authors With Largest Number of Citations</h1></br></br></br>

	<div class="chart"></div>

	<div id="info">
		<h2>Information</h2></br>
		<h4>The y-axis represents the number of citations for publications for the author on the x-axis.</br></br>
			Click on one of the bars to load the name of the associated author in Google.</br></h4>
	</div>

	<script type="text/javascript">

		$(document).ready(function() {
			// call to 'data.json' created in wos.php
			$.getJSON('data.json', function (data) {

				// javascript variable to store json data
				var topCited = data;

				// TESTS: 
				console.log("TOPCITED OBJECT: ");
				console.log(topCited);
				console.log("FIRST ELEMENT OF TOPCITED: ")
				console.log(topCited[0].author);
				console.log(topCited[0].citations_sum);
				// console.log(topCited[1].citations_sum);

				// append data to document under series of paragraphs (test)
				// enter() returns a reference to the placeholder elements for each data element that had no corresponding existing DOM element
				// i.e. in this case there exist no <p> elements, enter references this from the data and then appends a <p> element for each element in the data set
				d3.select("body").selectAll("p")
								 .data(topCited)
								 .enter()
								 .append("p");

				// use D3 text operator to assign text values to the paragraph elements, creates anonymous function (no name as only used here)
				// d refers to the current data attribut for the current element, i refers to the index of the current element
				d3.selectAll("p").text(function (d, i) {
					return i + ". " + d.author + "  =  " + d.citations_sum;
				});

				// establish some margins for the graph area to avoid overlap with other HTML elements
				var margin = {
								top: 30,
								right: 30,
								bottom: 150,
								left: 40
					 		 };

				// initiate variables for max width and height of canvas for chart, determine largest citation value for domain and scaling
				// width, 10 bars at 75px each plus 3px padding
				var height = 600;
				var width = 780;
				/* var maxY = d3.max(topCited, function (d) {
				    return d.citations_sum;	
				}); */

				var maxY = topCited[0].citations_sum;

				console.log("maxY: " + maxY);

				// set scale to alter data set so that it fits well in the canvas space
				// map the domain (actual data range) to the range (size of canvas)
				var linearScale = d3.scale.linear()
										  // 0 -> largest citations value
										  .domain([0, maxY])
										  // 0 -> 600
										  .range([0, height]);

				// TESTS: should = 600
				// console.log(linearScale(maxY));
				// console.log(linearScale(100));

				// create canvas for chart
				var svgContainer = d3.select(".chart").append("svg")
												      .attr("width", width)
									  				  // max size from data set plus 20px margin
									  				  .attr("height", height + margin.bottom)
									  				  // .style("border", "1px solid green");

				// create an SVG Grouped Element (<g>) to contain all the 'bars' of the graph
				var barGroup = svgContainer.append("g");

				// bind the data to SVG Rectangle elements
				var bar = barGroup.selectAll("rect")
								  .data(topCited)
								  .enter()
								  .append("rect")
								  .attr("fill", "#4aaeea")
								  // highlight each bar as you hover over it
								  .on("mouseover", function () {
								      d3.select(this)
								        .attr("fill", "darkblue");	
								  })
								  // transition to remove highlight from bar
								  .on("mouseout", function() {
								      d3.select(this)
								        .transition()
								        .duration(250)
								        .attr("fill", "#4aaeea");
								  });

				// set variable to store bar width + padding
				var barWidth = 78;

				// set attributes for the rectangles (bars)
				var rectAttributes = bar.attr("width", 75)
										// set bar height by value of citations_sum
										.attr("height", function (d) {
										    return linearScale(d.citations_sum);
										})
										// index * 78 will move each bar (width, 75px) one bar width along and leave 3px padding
										.attr("x", function (d, i) {
										    return i * barWidth;
										})
										// this is determined from the top left corner so to get the bar at the bottom, take the bar height from the canvas height
										.attr("y", function (d) {
										    return height - linearScale(d.citations_sum);
										})
										// .style("fill", "steelblue");

				// bind the data to SVG Text elements
				var text = barGroup.selectAll("text")
								   .data(topCited)
								   .enter()
								   .append("text");

				// set attributes for the text on bars (citation values)
				var barLabels = text.attr("x", function (d, i) {
									     return (barWidth * i) + 37.5; // sets to halfway between each bar horizontally
									 })
									 .attr("y", function (d) {
									     return height - (linearScale(d.citations_sum)) - 3; // sets to top of each bar + 5 to sit just above bar
									 })
									 .text(function (d) {
									     return d.citations_sum; // value to display, citations value (number)	
									 })
									 .style("text-anchor", "middle")
									 .attr("font-family", "Raleway")
									 .attr("font-size", "26px")
									 .attr("fill", "#4aaeea");

				// create a scale for the horizontal axis
				var xScale = d3.scale.ordinal()
									 .domain(data.map(function (d) {
									 	return d.author;
									 }))
									 .rangeRoundBands([0, width], 0);

				// create a scale for the vertical axis
				var yScale = d3.scale.linear()
									 .domain([0, maxY])
									 .range([height, 0]);

				// define x-axis
				var xAxis = d3.svg.axis()
								  .scale(xScale)
								  .orient("bottom")
								  .ticks(10);

				// define y-axis
				var yAxis = d3.svg.axis()
							  .scale(yScale)
							  .orient("left")
							  .ticks(10);

				// create x-axis
				svgContainer.append("g")
							.attr("class", "axis")
							.attr("transform", "translate(0, " + height + ")")
							.call(xAxis)
							.selectAll("text")
							.style("text-anchor", "end")
							// spacing
							.attr("dx", "-.8em")
							.attr("dy", ".15em")
							// rotate text as too long to display horizontally
							.attr("transform", function (d) {
							    return "rotate(-65)";
							});

				// create y-axis
				svgContainer.append("g")
							.attr("class", "axis")
							// .attr("transform", "translate(3,0)")
							.call(yAxis)
							// append a title to the y-axis
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", -70)
							.attr("x", -200)
							.style("text-anchor", "end")
							.attr("fill", "white")
							.attr("font-size", "24px")
							.text("Citations");

				// create link when user clicks on a single bar of data
				d3.selectAll("rect")
				  .on("click", function (d) {
				  	  // variable stores url for google and adds author name relevant to bar that was clicked
				      var url = "https://www.google.co.uk/#q=" + d.author;
				      // add an href html element with the url attached
				      $(location).attr("href", url);
				      window.location = url;
				  });

			});
		});

	</script>

	</br></br></br></br><h3>Try to find these authors on <a href="https://uk.linkedin.com/">LinkedIn</a> or the <a href="http://gtr.rcuk.ac.uk/">Gateway to Research</a> sites</h3></br></br>

</body>

</html>